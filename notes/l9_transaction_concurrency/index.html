
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.5.3, mkdocs-material-9.5.3" name="generator"/>
<title>50.043 - Transactions and Concurrency Control - Database System and Big Data 50.043</title>
<link href="../../assets/stylesheets/main.50c56a3b.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<style>:root{--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');}</style>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CSpline+Sans+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Spline Sans Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#50043-transactions-and-concurrency-control">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Database System and Big Data 50.043" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Database System and Big Data 50.043">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 3a2 2 0 0 1 2-2h9.982a2 2 0 0 1 1.414.586l4.018 4.018A2 2 0 0 1 21 7.018V21a2 2 0 0 1-2 2H4.75a.75.75 0 0 1 0-1.5H19a.5.5 0 0 0 .5-.5V8.5h-4a2 2 0 0 1-2-2v-4H5a.5.5 0 0 0-.5.5v6.25a.75.75 0 0 1-1.5 0Zm12-.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 0-.146-.336l-4.018-4.018A.5.5 0 0 0 15 2.5Z"></path><path d="M4.53 12.24a.75.75 0 0 1-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 1 1-1.022 1.1l-3.23-3a.75.75 0 0 1 0-1.1l3.23-3a.75.75 0 0 1 1.06.04Zm3.979 1.06a.75.75 0 1 1 1.02-1.1l3.231 3a.75.75 0 0 1 0 1.1l-3.23 3a.75.75 0 1 1-1.021-1.1l2.639-2.45-2.64-2.45Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Database System and Big Data 50.043
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              50.043 - Transactions and Concurrency Control
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../l1_course_handout/">
        
  
    
  
  Handout

      </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Database System and Big Data 50.043" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Database System and Big Data 50.043">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 3a2 2 0 0 1 2-2h9.982a2 2 0 0 1 1.414.586l4.018 4.018A2 2 0 0 1 21 7.018V21a2 2 0 0 1-2 2H4.75a.75.75 0 0 1 0-1.5H19a.5.5 0 0 0 .5-.5V8.5h-4a2 2 0 0 1-2-2v-4H5a.5.5 0 0 0-.5.5v6.25a.75.75 0 0 1-1.5 0Zm12-.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 0-.146-.336l-4.018-4.018A.5.5 0 0 0 15 2.5Z"></path><path d="M4.53 12.24a.75.75 0 0 1-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 1 1-1.022 1.1l-3.23-3a.75.75 0 0 1 0-1.1l3.23-3a.75.75 0 0 1 1.06.04Zm3.979 1.06a.75.75 0 1 1 1.02-1.1l3.231 3a.75.75 0 0 1 0 1.1l-3.23 3a.75.75 0 1 1-1.021-1.1l2.639-2.45-2.64-2.45Z"></path></svg>
</a>
    Database System and Big Data 50.043
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../l1_course_handout/">
<span class="md-ellipsis">
    Handout
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#learning-outcomes">
<span class="md-ellipsis">
      Learning Outcomes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recall-isolation">
<span class="md-ellipsis">
      Recall Isolation
    </span>
</a>
<nav aria-label="Recall Isolation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#serializability">
<span class="md-ellipsis">
      Serializability
    </span>
</a>
<nav aria-label="Serializability" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#schedule">
<span class="md-ellipsis">
      Schedule
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#serial-schedule">
<span class="md-ellipsis">
      Serial Schedule
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#state-and-instruction">
<span class="md-ellipsis">
      State and Instruction
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#serializable-schedule">
<span class="md-ellipsis">
      Serializable Schedule
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#serializability-check">
<span class="md-ellipsis">
      Serializability Check
    </span>
</a>
<nav aria-label="Serializability Check" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#conflict-serializability-check">
<span class="md-ellipsis">
      Conflict Serializability Check
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#update-of-terminologies">
<span class="md-ellipsis">
      Update of terminologies
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#operator-conflict">
<span class="md-ellipsis">
      Operator Conflict
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#execution-order">
<span class="md-ellipsis">
      Execution Order
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#conflict-equivalence">
<span class="md-ellipsis">
      Conflict Equivalence
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#conflict-serializable">
<span class="md-ellipsis">
      Conflict Serializable
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#an-example">
<span class="md-ellipsis">
      An example
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#conflict-serializable-check-algorithm">
<span class="md-ellipsis">
      Conflict Serializable Check Algorithm
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#two-phase-locking">
<span class="md-ellipsis">
      Two Phase Locking
    </span>
</a>
<nav aria-label="Two Phase Locking" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#strict-2pl">
<span class="md-ellipsis">
      Strict 2PL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2pl">
<span class="md-ellipsis">
      2PL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#strict-2pl-vs-2pl">
<span class="md-ellipsis">
      Strict 2PL vs 2PL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#conservative-2pl">
<span class="md-ellipsis">
      Conservative 2PL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deadlock">
<span class="md-ellipsis">
      Deadlock
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deadlock-detection">
<span class="md-ellipsis">
      Deadlock detection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deadlock-prevention">
<span class="md-ellipsis">
      Deadlock prevention
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="50043-transactions-and-concurrency-control">50.043 - Transactions and Concurrency Control<a class="headerlink" href="#50043-transactions-and-concurrency-control" title="Permanent link">¶</a></h1>
<h2 id="learning-outcomes">Learning Outcomes<a class="headerlink" href="#learning-outcomes" title="Permanent link">¶</a></h2>
<p>By the end of this unit, you should be able to</p>
<ol>
<li>Explain serializability, confict serializability.</li>
<li>Apply conflict serializability check to schedule.</li>
<li>Explain Strict 2PL and 2PL</li>
<li>Apply Strict 2PL and 2PL to generate conflict serialiable schedules.</li>
</ol>
<h2 id="recall-isolation">Recall Isolation<a class="headerlink" href="#recall-isolation" title="Permanent link">¶</a></h2>
<p>Recall from the previous unit, we learn that the isoliation property ensures that multiple concurrent transactions must not be dependent on one another. In other words, if the DBMS executing these concurrent transactions by interleaving, the result be the same as executing them in a sequential order. </p>
<h3 id="serializability">Serializability<a class="headerlink" href="#serializability" title="Permanent link">¶</a></h3>
<p>Suppose we have a set of tasks <span class="arithmatex">\(t_1,...,t_n\)</span>, each task <span class="arithmatex">\(t_i\)</span> consists of a sequence of instructions <span class="arithmatex">\(c^i_1,..., c^i_{m_i}\)</span>. </p>
<h4 id="schedule">Schedule<a class="headerlink" href="#schedule" title="Permanent link">¶</a></h4>
<p>We call a sequence of distinct instructions <span class="arithmatex">\(c_1,...,c_k\)</span> a schedule of tasks <span class="arithmatex">\(t_1,...,t_n\)</span>, iff </p>
<ol>
<li>for all <span class="arithmatex">\(i\in\{1,n\}\)</span>, for all <span class="arithmatex">\(p \in \{1, m_i\}\)</span>, we find <span class="arithmatex">\(c^i_p \in \{c_1,...,c_k\}\)</span>.</li>
<li>for all <span class="arithmatex">\(q \in \{1,k\}\)</span>, there exist <span class="arithmatex">\(i\in\{1,n\}\)</span> and <span class="arithmatex">\(p \in  \{1, m_i\}\)</span> such that <span class="arithmatex">\(c_q = c^i_p\)</span>.</li>
<li>for all  <span class="arithmatex">\(q \in \{1,k\}\)</span> and <span class="arithmatex">\(q' \in \{q,k\}\)</span>, there not exist <span class="arithmatex">\(i\in\{1,n\}\)</span> and <span class="arithmatex">\(p \in  \{1, m_i\}\)</span> and <span class="arithmatex">\(p' \in \{p, m_i\}\)</span> such that <span class="arithmatex">\(c_q = c^i_{p'}\)</span> and <span class="arithmatex">\(c_{q'} = c^i_p\)</span>.</li>
</ol>
<p>The first rule enforces all instructions in the tasks can be found in the schedule. 
The second rule enforces all instructions in the schedule can be found in the tasks.
The third rule enforce that the relative order between instructions from the same task are maintained in the schedule.</p>
<h4 id="serial-schedule">Serial Schedule<a class="headerlink" href="#serial-schedule" title="Permanent link">¶</a></h4>
<p>Given tasks <span class="arithmatex">\(t_1,...,t_n\)</span> and a schedule  <span class="arithmatex">\(c_1,...,c_k\)</span>, we say <span class="arithmatex">\(c_1,...,c_k\)</span> is a <em>serial schedule</em> of <span class="arithmatex">\(t_1,...,t_n\)</span> iff</p>
<ol>
<li>there not exists a sub-sequence <span class="arithmatex">\(c_{q-1}, c_{q}, c_{q+1}\)</span> of <span class="arithmatex">\(c_1,...,c_k\)</span> such that <span class="arithmatex">\(c_{q-1}\)</span> and <span class="arithmatex">\(c_{q+1}\)</span> are instructions from task <span class="arithmatex">\(t_j\)</span> and <span class="arithmatex">\(c_q\)</span> is an instruction from task <span class="arithmatex">\(t_i\)</span>, for some <span class="arithmatex">\(i\)</span> and <span class="arithmatex">\(j\)</span> in <span class="arithmatex">\(\{1,n\}\)</span>.</li>
</ol>
<p>In other words, a schedule is <em>serial</em> iff there is no interleaving.</p>
<p>Note that given a set of tasks <span class="arithmatex">\(t_1,...,t_n\)</span>, there are in total <span class="arithmatex">\(n!\)</span> serial schedules.</p>
<h4 id="state-and-instruction">State and Instruction<a class="headerlink" href="#state-and-instruction" title="Permanent link">¶</a></h4>
<p>Given two database states <span class="arithmatex">\(s_1\)</span> and <span class="arithmatex">\(s_2\)</span>, and an instruction <span class="arithmatex">\(c\)</span>, 
we say <span class="arithmatex">\(s_1\vdash c \rightarrow s_2\)</span> to denote execution <span class="arithmatex">\(c\)</span> in the database with in state <span class="arithmatex">\(s_1\)</span> results in state <span class="arithmatex">\(s_2\)</span>. </p>
<p>Inductively, we can define </p>
<p><span class="arithmatex">\(s_1 \vdash c_1,c_2,...,c_n \rightarrow s_n\)</span> iff <span class="arithmatex">\(s_1 \vdash c_1 \rightarrow s_2\)</span> and  <span class="arithmatex">\(s_2 \vdash c_2,...,c_n \rightarrow s_n\)</span>.</p>
<h4 id="serializable-schedule">Serializable Schedule<a class="headerlink" href="#serializable-schedule" title="Permanent link">¶</a></h4>
<p>Given tasks <span class="arithmatex">\(t_1,...,t_n\)</span> and a schedule  <span class="arithmatex">\(c_1,...,c_k\)</span>, we say  <span class="arithmatex">\(c_1,...,c_k\)</span> is <em>serializable</em> iff there exists a serial schedule of  <span class="arithmatex">\(t_1,...,t_n\)</span>, i.e. <span class="arithmatex">\(c_1',...,c_k'\)</span> such that <span class="arithmatex">\(s_1 \vdash c_1,...,c_k \rightarrow s_2\)</span> and <span class="arithmatex">\(s_1 \vdash c_1',...,c_k' \rightarrow s_2'\)</span> and <span class="arithmatex">\(s_2 = s_2'\)</span>.</p>
<p>In other words, a schedule is serializable if its effect is the same as a serial schedule after execution.</p>
<p>For example, consider the following transaction</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1">-- transaction 1</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">begin</span><span class="p">;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="k">select</span><span class="w"> </span><span class="o">@</span><span class="n">bal1</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">bal</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">saving</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1001</span><span class="p">;</span><span class="w">    </span><span class="c1">-- c1</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="k">update</span><span class="w"> </span><span class="n">saving</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">bal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">bal1</span><span class="o">-</span><span class="mi">100</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1001</span><span class="p">;</span><span class="w">  </span><span class="c1">-- c2</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="k">commit</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-sql highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1">-- transaction 2</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="k">begin</span><span class="p">;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="k">select</span><span class="w"> </span><span class="o">@</span><span class="n">bal2</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">bal</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">saving</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1001</span><span class="p">;</span><span class="w">    </span><span class="c1">-- c1'</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="k">update</span><span class="w"> </span><span class="n">saving</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">bal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">bal2</span><span class="o">*</span><span class="mi">1</span><span class="p">.</span><span class="mi">05</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1001</span><span class="p">;</span><span class="w"> </span><span class="c1">-- c2'</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="k">commit</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<p>The schedules <code>c1,c2,c1',c2'</code> and <code>c1',c2',c1,c2</code> are serializable schedules, but <code>c1,c1',c2,c2'</code> is not a serializable schedule, we illustrate the state and instruction execution as follows</p>
<table>
<thead>
<tr>
<th>state before</th>
<th>instruction</th>
<th>state after</th>
</tr>
</thead>
<tbody>
<tr>
<td>100</td>
<td>c1</td>
<td>100, bal1 = 100</td>
</tr>
<tr>
<td>100,bal1 = 100</td>
<td>c1'</td>
<td>100, bal1 = 100, bal2 = 100</td>
</tr>
<tr>
<td>100, bal1 = 100, bal2 = 100</td>
<td>c2</td>
<td>0, bal1 = 100, bal2 = 100</td>
</tr>
<tr>
<td>0, bal1 = 100, bal2 = 100</td>
<td>c2'</td>
<td>105, bal1 = 100, bal2 = 100</td>
</tr>
</tbody>
</table>
<p>At the end of execution, we found the balance of account <code>1001</code> is 105 though we withdraw 100 from this account in transaction1.</p>
<h3 id="serializability-check">Serializability Check<a class="headerlink" href="#serializability-check" title="Permanent link">¶</a></h3>
<p>Our dream approach is to be able to check whether the given schedule is serializable without executing it. However such a check is very expensive because</p>
<ol>
<li>there are <span class="arithmatex">\(n!\)</span> possible serial schedules we need to verify the given one against.</li>
<li>we need to model the set of possible operations and the value domains (without executing them).</li>
</ol>
<p>Our second best approach is to use a conservative approximation check, say <span class="arithmatex">\(C(s)\)</span> where <span class="arithmatex">\(C\)</span> is the approximation check and <span class="arithmatex">\(s\)</span> is a schedule, such that <span class="arithmatex">\(C(s)\)</span> yields true implies <span class="arithmatex">\(s\)</span> is serializable. </p>
<p>Note that we don't need to guarantee the inverse direction still holds (since <span class="arithmatex">\(C\)</span> is a conservative approximation).</p>
<h4 id="conflict-serializability-check">Conflict Serializability Check<a class="headerlink" href="#conflict-serializability-check" title="Permanent link">¶</a></h4>
<p>One possible of consevative approximation is <em>Conflict Serializability Check</em>.</p>
<h4 id="update-of-terminologies">Update of terminologies<a class="headerlink" href="#update-of-terminologies" title="Permanent link">¶</a></h4>
<p>From this point onwards, we sometimes refer</p>
<ul>
<li>an instruction <span class="arithmatex">\(c\)</span> as an operator, which could be <span class="arithmatex">\(R(A)\)</span> or <span class="arithmatex">\(W(A)\)</span> where <span class="arithmatex">\(R(\cdot)\)</span> stands for the read operator, and <span class="arithmatex">\(A\)</span> is the object that being read, <span class="arithmatex">\(W(\cdot)\)</span> denotes a write operator.</li>
<li>a task <span class="arithmatex">\(t\)</span> as an transaction <span class="arithmatex">\(T\)</span>.</li>
<li>a state <span class="arithmatex">\(s\)</span> is a mapping from objects, such as <span class="arithmatex">\(A\)</span>, <span class="arithmatex">\(B\)</span>, etc to values.</li>
</ul>
<h4 id="operator-conflict">Operator Conflict<a class="headerlink" href="#operator-conflict" title="Permanent link">¶</a></h4>
<p>Two instructions <span class="arithmatex">\(c_1\)</span> and <span class="arithmatex">\(c_2\)</span> are conflict iff</p>
<ul>
<li><span class="arithmatex">\(c_1\)</span> and <span class="arithmatex">\(c_2\)</span> belong to different transactions and </li>
<li><span class="arithmatex">\((c_1 = R(A) \wedge c_2 = W(A))\)</span> or <span class="arithmatex">\((c_1 = W(A) \wedge c_2 = R(A))\)</span> or <span class="arithmatex">\((c_1 = W(A) \wedge c_2 = W(A))\)</span> for some common object <span class="arithmatex">\(A\)</span> in the state.</li>
</ul>
<h4 id="execution-order">Execution Order<a class="headerlink" href="#execution-order" title="Permanent link">¶</a></h4>
<p>Given a schedule <span class="arithmatex">\(X = c_1,...,c_n\)</span>, we say <span class="arithmatex">\(c_i \prec c_j\)</span> iff  <span class="arithmatex">\(1 \leq i \wedge  i &lt; j \wedge j \leq n\)</span></p>
<p>Intuitively, <span class="arithmatex">\(c_i \prec c_j\)</span> means <span class="arithmatex">\(c_i\)</span> is executed before <span class="arithmatex">\(c_j\)</span> in a schedule <span class="arithmatex">\(X\)</span>.</p>
<h4 id="conflict-equivalence">Conflict Equivalence<a class="headerlink" href="#conflict-equivalence" title="Permanent link">¶</a></h4>
<p>Given two schedules <span class="arithmatex">\(X = c_1,...,c_n\)</span> and <span class="arithmatex">\(X' = c_1',...,c_n'\)</span> are <em>conflict equivalent</em> iff</p>
<ol>
<li>both schedules belong to the same set of transactions. </li>
<li>for any pair of conflicting operators <span class="arithmatex">\((c_i, c_j)\)</span> in <span class="arithmatex">\(X\)</span>, such that <span class="arithmatex">\(c_i \prec c_j\)</span>, we find <span class="arithmatex">\((c_k', c_l')\)</span> in <span class="arithmatex">\(X'\)</span> such that <span class="arithmatex">\(c_k' \prec c_l'\)</span> and <span class="arithmatex">\(c_i = c_k'\)</span> and <span class="arithmatex">\(c_j = c_l'\)</span>.</li>
</ol>
<p>In other words, the second condition in the above definition says that all conflicting operators in <span class="arithmatex">\(X\)</span> have the same relative execution order (within the conflicting pair) in <span class="arithmatex">\(X'\)</span>.</p>
<h4 id="conflict-serializable">Conflict Serializable<a class="headerlink" href="#conflict-serializable" title="Permanent link">¶</a></h4>
<p>Given a set of tasks <span class="arithmatex">\(t_1,...,t_n\)</span>, a schedule <span class="arithmatex">\(X\)</span> is conflict serializable iff it is conflict equivalent to some schedule <span class="arithmatex">\(X'\)</span> of tasks <span class="arithmatex">\(t_1,...,t_n\)</span> such that <span class="arithmatex">\(X'\)</span> is serial.</p>
<h4 id="an-example">An example<a class="headerlink" href="#an-example" title="Permanent link">¶</a></h4>
<p>Consider the following example with two transactions </p>
<ul>
<li><code>T1: R(A), W(A), R(B), W(B)</code></li>
<li><code>T2: R(A), W(A), R(B), W(B)</code></li>
</ul>
<p>Let's say </p>
<ul>
<li><code>T1:R(A), W(A)</code> is to increment <code>A</code>'s value by 10.</li>
<li><code>T1:R(B), W(B)</code> is to increment <code>B</code>'s value by 10.</li>
<li><code>T2:R(A), W(A)</code> is to double <code>A</code>'s value.</li>
<li><code>T2:R(B), W(B)</code> is to double <code>B</code>'s value.</li>
</ul>
<p>Note that there are 2! = 2 possible serial schedules.</p>
<ul>
<li>Serial schedule 1</li>
</ul>
<table>
<thead>
<tr>
<th>T1</th>
<th>T2</th>
</tr>
</thead>
<tbody>
<tr>
<td>R(A)</td>
<td></td>
</tr>
<tr>
<td>W(A)</td>
<td></td>
</tr>
<tr>
<td>R(B)</td>
<td></td>
</tr>
<tr>
<td>W(B)</td>
<td></td>
</tr>
<tr>
<td></td>
<td>R(A)</td>
</tr>
<tr>
<td></td>
<td>W(A)</td>
</tr>
<tr>
<td></td>
<td>R(B)</td>
</tr>
<tr>
<td></td>
<td>W(B)</td>
</tr>
</tbody>
</table>
<p>assuming the initial state is <code>{A:10, B:10}</code>, the final state of the above is <code>{A:40, B:40}</code>.</p>
<ul>
<li>Serial schedule 2 </li>
</ul>
<table>
<thead>
<tr>
<th>T1</th>
<th>T2</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>R(A)</td>
</tr>
<tr>
<td></td>
<td>W(A)</td>
</tr>
<tr>
<td></td>
<td>R(B)</td>
</tr>
<tr>
<td></td>
<td>W(B)</td>
</tr>
<tr>
<td>R(A)</td>
<td></td>
</tr>
<tr>
<td>W(A)</td>
<td></td>
</tr>
<tr>
<td>R(B)</td>
<td></td>
</tr>
<tr>
<td>W(B)</td>
<td></td>
</tr>
</tbody>
</table>
<p>assuming the initial state is <code>{A:10, B:10}</code>, the final state of the above is <code>{A:30, B:30}</code>.</p>
<p>Now let's consider the following schedule (let's call it schedule 3)</p>
<table>
<thead>
<tr>
<th>T1</th>
<th>T2</th>
</tr>
</thead>
<tbody>
<tr>
<td>R(A)</td>
<td></td>
</tr>
<tr>
<td>W(A)</td>
<td></td>
</tr>
<tr>
<td></td>
<td>R(A)</td>
</tr>
<tr>
<td></td>
<td>W(A)</td>
</tr>
<tr>
<td></td>
<td>R(B)</td>
</tr>
<tr>
<td></td>
<td>W(B)</td>
</tr>
<tr>
<td>R(B)</td>
<td></td>
</tr>
<tr>
<td>W(B)</td>
<td></td>
</tr>
</tbody>
</table>
<p>Note that the above schedule is not conflict serializable, because </p>
<ol>
<li>conflicting operator pair <span class="arithmatex">\(T2:W(B) \prec T1:R(B)\)</span> cannot be reordered to obtain serial schedule 1, and </li>
<li>conflicting pair <span class="arithmatex">\(T1:W(A) \prec T2:R(A)\)</span> cannot be reordered to obtain serial schedule 2.</li>
</ol>
<p>If we were to execute the above non-conflict serializable schedule with the init state <code>{A:10, B:10}</code>, we get <code>{A:40, B:30}</code>.</p>
<p>Recall that conflict serialiability is a conservative approximation of serialzability. Suppose we change the operation of <code>T2</code> </p>
<ul>
<li><code>T2:R(A), W(A)</code> is to increase <code>A</code>'s value by 20.</li>
<li><code>T2:R(B), W(B)</code> is to increase <code>B</code>'s value by 20.</li>
</ul>
<p>Given the init state <code>{A:10, B:10}</code>,  serial schedule 1, serial schedule 2 and schedule 3 generate <code>{A:30, B:30}</code>, which means that after the change of the operation of <code>T2</code>, schedule 3 becomes serializable, but still not conflict serializable.</p>
<h4 id="conflict-serializable-check-algorithm">Conflict Serializable Check Algorithm<a class="headerlink" href="#conflict-serializable-check-algorithm" title="Permanent link">¶</a></h4>
<p>In the above example, we illustrate the Conflict Serializable check via a table and manual checking. </p>
<p>To implement the idea as an algorithm we could leverage on a directed graph, called precedence graph.</p>
<p>The precedence graph is generated from a schedule <span class="arithmatex">\(X\)</span> as follow.</p>
<ol>
<li>For each transaction <span class="arithmatex">\(t\)</span>, create a node <span class="arithmatex">\(n_t\)</span>.</li>
<li>For each pair of transactions <span class="arithmatex">\(t\)</span> and <span class="arithmatex">\(t'\)</span>, if there exists a conflicting pair of operators <span class="arithmatex">\(t:c \prec t':c'\)</span> in <span class="arithmatex">\(X\)</span>, we draw an directed arc from <span class="arithmatex">\(n_t\)</span> to <span class="arithmatex">\(n_{t'}\)</span>.</li>
</ol>
<p>A schedule <span class="arithmatex">\(X\)</span> is conflict serialzable if its precendence graph is acyclic.</p>
<p>For instance, the precendence graph of the schedule 3 in the previous example is as follows</p>
<pre class="mermaid"><code>graph
T1 --&gt; T2
T1 --&gt; T2
T2 --&gt; T1
T2 --&gt; T1</code></pre>
<h3 id="two-phase-locking">Two Phase Locking<a class="headerlink" href="#two-phase-locking" title="Permanent link">¶</a></h3>
<p>Generate schedule in a bruteforce way then check for conflict serializablity is still impractical. DBMSes use <em>Two Phase Locking</em> (2PL) to generate conflict serializable schedule.</p>
<h4 id="strict-2pl">Strict 2PL<a class="headerlink" href="#strict-2pl" title="Permanent link">¶</a></h4>
<p>Let's consider a strict version of two phase locking is called Strict 2PL. It is governed by the following two rules.</p>
<ol>
<li>When a transaction need to read an object <span class="arithmatex">\(A\)</span>, it needs to acquire a shared lock <span class="arithmatex">\(S(A)\)</span>; when it need to write an object <span class="arithmatex">\(A\)</span>, it needs to aquire an exclusive lock <span class="arithmatex">\(X(A)\)</span>. A shared lock can be shared by multiple reader transactions. An exclusive lock cannot be shared.</li>
<li>All locks are only released <span class="arithmatex">\(U(A)\)</span>, when the transaction commit.</li>
</ol>
<p>The requests for lock <span class="arithmatex">\(S(A)\)</span>, <span class="arithmatex">\(X(A)\)</span> and release of lock <span class="arithmatex">\(U(A)\)</span> are inserted by the DBMSes as schedule being generated.</p>
<p>Let's consider the earlier example with  with two transactions </p>
<ul>
<li><code>T1: R(A), W(A), R(B), W(B)</code></li>
<li><code>T2: R(A), W(A), R(B), W(B)</code></li>
</ul>
<p>Suppose <code>T1</code> starts slightly earlier than <code>T2</code>. A schedule is generated with strict 2PL as follows</p>
<table>
<thead>
<tr>
<th>Timestep</th>
<th>T1</th>
<th>T2</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>X(A)</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>R(A)</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>W(A)</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>X(B)</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>R(B)</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td>W(B)</td>
<td></td>
</tr>
<tr>
<td>7</td>
<td>U(A), U(B), Commit</td>
<td></td>
</tr>
<tr>
<td>8</td>
<td></td>
<td>X(A)</td>
</tr>
<tr>
<td>9</td>
<td></td>
<td>R(A)</td>
</tr>
<tr>
<td>10</td>
<td></td>
<td>W(A)</td>
</tr>
<tr>
<td>11</td>
<td></td>
<td>X(B)</td>
</tr>
<tr>
<td>12</td>
<td></td>
<td>R(B)</td>
</tr>
<tr>
<td>13</td>
<td></td>
<td>W(B)</td>
</tr>
<tr>
<td>14</td>
<td></td>
<td>U(A), U(B), Commit</td>
</tr>
</tbody>
</table>
<ol>
<li>At timestep 1, <code>T1</code> acquires the exclusive lock on <code>A</code> since it needs to read and write to it. <code>T2</code> is blocked as it would also need to acquire an exclusive lock on <code>A</code> to start. </li>
<li>At timestep 4, <code>T1</code> acquires the exclusive lock on <code>B</code>.</li>
<li>At timestep 7, <code>T1</code> is commited, hence both locks are released.</li>
<li>At timestep 8, <code>T2</code>  acquires lock on <code>A</code> and starts.  </li>
</ol>
<h4 id="2pl">2PL<a class="headerlink" href="#2pl" title="Permanent link">¶</a></h4>
<p>Once issue with Strict 2PL is that a transaction holds on to the locks it acquires until it commits, this blocks off other possible concurrent execution opportunity, hence throughput might be affected.</p>
<p>A variant of Strict 2PL, known as 2PL, is governed by the following two rules. (First rule is the same as Strict 2PL, the second rule is different).</p>
<ol>
<li>When a transaction needs to read an object <span class="arithmatex">\(A\)</span>, it needs to acquire a shared lock <span class="arithmatex">\(S(A)\)</span>; when it needs to write an object <span class="arithmatex">\(A\)</span>, it needs to aquire an exclusive lock <span class="arithmatex">\(X(A)\)</span>. A shared lock can be shared by multiple reader transactions. An exclusive lock cannot be shared.</li>
<li>A transaction releases the lock right after usage. A transaction cannot acquire new lock once it releases some lock.</li>
</ol>
<p>The reason why this is called a two phase locking is that there is a phase of lock acquisition, the number of locks being acquired by a transaction grows until it starts to release some lock, then it will release all the locks gradually.</p>
<p>Given the same example, a schedule is generated with 2PL as follows</p>
<table>
<thead>
<tr>
<th>Timestep</th>
<th>T1</th>
<th>T2</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>X(A)</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>R(A)</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>W(A)</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>X(B)</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>U(A)</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td></td>
<td>X(A)</td>
</tr>
<tr>
<td>7</td>
<td></td>
<td>R(A)</td>
</tr>
<tr>
<td>8</td>
<td></td>
<td>W(A)</td>
</tr>
<tr>
<td>9</td>
<td>R(B)</td>
<td></td>
</tr>
<tr>
<td>10</td>
<td>W(B)</td>
<td></td>
</tr>
<tr>
<td>11</td>
<td>U(B), Commit</td>
<td></td>
</tr>
<tr>
<td>12</td>
<td></td>
<td>X(B)</td>
</tr>
<tr>
<td>13</td>
<td></td>
<td>U(A)</td>
</tr>
<tr>
<td>14</td>
<td></td>
<td>R(B)</td>
</tr>
<tr>
<td>15</td>
<td></td>
<td>W(B)</td>
</tr>
<tr>
<td>16</td>
<td></td>
<td>U(B), Commit</td>
</tr>
</tbody>
</table>
<ol>
<li>At timestep 1, <code>T1</code> acquires an exclusive lock on <code>A</code> and starts, <code>T2</code> is blocked and waits.</li>
<li>At timestep 4, <code>T1</code> is done with <code>A</code>, but needs to acquire an exclusive lock on <code>B</code> before releasing <code>A</code>.</li>
<li>At timestep 6, <code>T2</code> acuiqres an exclusive lock on <code>A</code> and starts and runs until timestep 8, it needs to acquire an exclusive lock on <code>B</code> but it is blocked.</li>
<li>At timesteps 9-10, <code>T1</code> operates on <code>B</code>.</li>
<li>At timestep 11, <code>T1</code> releases lock on <code>B</code> and is commited.</li>
<li>At timestep 12, <code>T2</code> is unblocked and acquires the exclusive lock on <code>B</code>, it then releases lock on <code>A</code> and continues with the rest of operations.</li>
</ol>
<p>Note that schedules generated by both Strict 2PL and 2PL are <em>conflict serializable</em>. (Proof omitted.)</p>
<h4 id="strict-2pl-vs-2pl">Strict 2PL vs 2PL<a class="headerlink" href="#strict-2pl-vs-2pl" title="Permanent link">¶</a></h4>
<p>2PL in general yields a better throughput compared to Strict 2PL by allowing some transaction to start early. Such gain comes with a price. 2PL might produce schedules that are harder to recover due to cascading abort.</p>
<p>Consider the following schedule generated by 2PL, we keep the begin and commit explicit.</p>
<table>
<thead>
<tr>
<th>Timestep</th>
<th>T1</th>
<th>T2</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>begin</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>X(A)</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>A=10</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>X(B)</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>U(A)</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td></td>
<td>begin</td>
</tr>
<tr>
<td>7</td>
<td></td>
<td>X(A)</td>
</tr>
<tr>
<td>8</td>
<td></td>
<td>A=A+1</td>
</tr>
<tr>
<td>9</td>
<td></td>
<td>U(A)</td>
</tr>
<tr>
<td>10</td>
<td></td>
<td>commit</td>
</tr>
</tbody>
</table>
<p>Assume the initial state is <code>A=0</code>, executing the above schedule yields the following Undo/Redo Log</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a>1.  &lt;T1 begin&gt;
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a>2.  &lt;T1 update A 0 10&gt;
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a>3.  &lt;T2 begin&gt;
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a>4.  &lt;T2 update A 10 11&gt;
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a>5.  &lt;T2 commit&gt;
</span></code></pre></div></td></tr></table></div>
<p>After timestep 11, the database crashes.</p>
<p>During the recovery phase, we start with undo phase, we find that T1 need to be undone and aborted.
However, T2's effect of <code>A=A+1</code> is based on the assumption that <code>A=10</code> in T1 was successful. As a result, T2 has be to aborted and undone too. This is known as cascading abort.</p>
<h4 id="conservative-2pl">Conservative 2PL<a class="headerlink" href="#conservative-2pl" title="Permanent link">¶</a></h4>
<p>Another variant of Strict 2PL is called <em>Conservative 2PL</em>. It is same as Strick 2PL except that a transaction acquires all the locks it needs at the very begining. </p>
<p>For instance, given the previous example, a schedule is generated with conservative 2PL as follows</p>
<table>
<thead>
<tr>
<th>Timestep</th>
<th>T1</th>
<th>T2</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>X(A),X(B)</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>R(A)</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>W(A)</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>R(B)</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>W(B)</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td>U(A), U(B), Commit</td>
<td></td>
</tr>
<tr>
<td>7</td>
<td></td>
<td>X(A),X(B)</td>
</tr>
<tr>
<td>8</td>
<td></td>
<td>R(A)</td>
</tr>
<tr>
<td>9</td>
<td></td>
<td>W(A)</td>
</tr>
<tr>
<td>10</td>
<td></td>
<td>X(B)</td>
</tr>
<tr>
<td>11</td>
<td></td>
<td>R(B)</td>
</tr>
<tr>
<td>12</td>
<td></td>
<td>W(B)</td>
</tr>
<tr>
<td>13</td>
<td></td>
<td>U(A), U(B), Commit</td>
</tr>
</tbody>
</table>
<p>Note that all the locks are acquired by a transaction in an atomic operation, i.e. all or none. This is a way to prevent deadlock. </p>
<h4 id="deadlock">Deadlock<a class="headerlink" href="#deadlock" title="Permanent link">¶</a></h4>
<p>Let's consider how deadlock can be caused by 2PL (and Strict 2PL).</p>
<p>Consider the following transactions</p>
<ul>
<li><code>T1: R(A), W(A), R(B), W(B)</code></li>
<li><code>T2: R(B), W(B), R(A), W(A)</code></li>
</ul>
<p>and a schedule</p>
<table>
<thead>
<tr>
<th>Timestep</th>
<th>T1</th>
<th>T2</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>X(A)</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>R(A)</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>W(A)</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td></td>
<td>X(B)</td>
</tr>
<tr>
<td>5</td>
<td></td>
<td>R(B)</td>
</tr>
<tr>
<td>6</td>
<td></td>
<td>W(B)</td>
</tr>
<tr>
<td>7</td>
<td>try X(B) but blocked</td>
<td>try X(A) but blocked</td>
</tr>
</tbody>
</table>
<ol>
<li>At timestep 1, <code>T1</code> acquires an exclusive lock on <code>A</code> and starts</li>
<li>At timestep 4, <code>T2</code> acquires an exclusive lock on <code>B</code> and starts</li>
<li>AT timestep 7, <code>T1</code> tries to get a lock on <code>B</code> but it gets blocked. <code>T2</code> tries to get a lock on <code>A</code> but it is blocked too. A deadlock arises.</li>
</ol>
<h4 id="deadlock-detection">Deadlock detection<a class="headerlink" href="#deadlock-detection" title="Permanent link">¶</a></h4>
<p>A way to detect deadlock is that when transactions waiting for locks, the lock manager (part of DBMS) generate a wait-for graph. </p>
<p>In a wait for graph, </p>
<ul>
<li>each active transaction <span class="arithmatex">\(t\)</span> is a node <span class="arithmatex">\(n_t\)</span>.</li>
<li>an arc going from <span class="arithmatex">\(n_t\)</span> to <span class="arithmatex">\(n_t'\)</span> if transaction <span class="arithmatex">\(t\)</span> is waiting for a lock which is being held by <span class="arithmatex">\(t'\)</span>.</li>
</ul>
<p>For insance, the wait-for graph from the previous example is </p>
<pre class="mermaid"><code>graph
T1 --&gt; T2
T2 --&gt; T1</code></pre>
<h4 id="deadlock-prevention">Deadlock prevention<a class="headerlink" href="#deadlock-prevention" title="Permanent link">¶</a></h4>
<p>To prevent deadlock, there are several approaches</p>
<ol>
<li>Use conservative 2PL, but throughput will be affected.</li>
<li>Set priorities. Transactions with higher priorty get the lock. Transaction wth lower prioerty get aborted and retry.</li>
</ol>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.code.copy", "navigation.expand", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.d7c377c4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>